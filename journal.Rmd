---
title: "Journal (reproducible report)"
author: "Kristin Schüler"
date: "2020-11-05"
output:
  html_document:
    toc: true
    toc_float: true
    collapsed: false
    number_sections: true
    toc_depth: 3
    #code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message=FALSE,warning=FALSE, cache=TRUE)
```

**IMPORTANT:** You can delete everything in here and start fresh. You might want to start by not deleting anything above this line until you know what that stuff is doing.

This is an `.Rmd` file. It is plain text with special features. Any time you write just like this, it will be compiled to normal text in the website. If you put a \# in front of your text, it will create a top level-header.

# First challenge - Sales data analysis 
Date: 2020-28-11
Data Science Basic - WiSe 2020/21  

## Preperation

### Clear the environment and load packages 

```{r}
rm(list=ls())#Clear list
#install.packages("lubridate") #installed the packeges once in the beginning
#install.packages("writexl")

####Load libraries
library(tidyverse)
library("readxl")
library(lubridate)
library("writexl")
library(ggplot2)
library(scales)
```

### Importing Files

```{r}
Bikes<-read_excel("C:/Users/Kristin/Documents/Working directory/00_data/01_bike_sales/01_raw_data/bikes.xlsx")
Bikeshops<-read_excel("C:/Users/Kristin/Documents/Working directory/00_data/01_bike_sales/01_raw_data/bikeshops.xlsx")
Orderlines<-read_excel("C:/Users/Kristin/Documents/Working directory/00_data/01_bike_sales/01_raw_data/orderlines.xlsx")
```

### Joining Data

```{r}
Summary_table2 <- Orderlines %>% left_join(Bikes, by = c("product.id" = "bike.id"))%>% left_join(Bikeshops, by = c("customer.id" = "bikeshop.id"))
glimpse(Summary_table2, eval=TRUE)
```

## Wrangling and shortening Data

### Wrangling data

```{r}
wrangled_table2<-Summary_table2 %>% 
  separate(col = location, into = c("city", "state_of_sale"),sep = ", ", convert = T) %>% 
  mutate(Total_Amount = quantity*price)%>% 
  select(contains("order"), contains("model"), contains("category"),price, quantity, Total_Amount, everything())%>%  
  rename(bikeshop = name) %>%set_names(names(.) %>% str_replace_all("\\.", "_"))
glimpse(wrangled_table2, eval=TRUE)
```

### Rearranging and shortening wrangled Data

```{r}
Short_table2<-wrangled_table2%>%  select(order_id, order_date, city, state_of_sale, price, quantity, Total_Amount)
glimpse(Short_table2, eval=TRUE)
```

## Business Insights

### Sales by Location

#### Step 1 - Manipulate

```{r}
sales_by_Location<- Short_table2%>%  
  select(state_of_sale, Total_Amount)%>%
  group_by(state_of_sale)%>% 
  summarize(sales = sum(Total_Amount))%>% 
  mutate(sales_in_Euro = scales::dollar(sales, big.mark = ".", 
                                        decimal.mark = ",", 
                                        prefix = "", 
                                        suffix = " €"))
glimpse(sales_by_Location, eval=TRUE)
```

#### Step 2 - Visualize

```{r, fig.width=10, fig.height=10}
sales_by_Location%>%
  ggplot(aes(x = state_of_sale, y = sales)) +
  geom_col(fill = "blue") + 
  geom_label(aes(label = sales_in_Euro)) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_continuous(labels = scales::dollar_format(big.mark = ".", 
                                                    decimal.mark = ",", 
                                                    prefix = "", 
                                                    suffix = " €")) + #adjusting to Euros
  labs(title = "Revenue of bike sales by location",
       subtitle = "Bike stores available in 12 states",
       x = "", y = "Revenue")
```

### Sales by Year and Location

##### Step 1 - Manipulate

```{r}
sales_year_Location<- Short_table2%>%  
  select(order_date, Total_Amount, state_of_sale)%>%
  mutate(year=year(order_date))%>%
  group_by(year, state_of_sale)%>% 
  summarize(sales = sum(Total_Amount))%>% 
  ungroup() %>%
  mutate(sales_in_Euro = scales::dollar(sales, big.mark = ".", 
                                        decimal.mark = ",", 
                                        prefix = "", 
                                        suffix = " €"))
glimpse(sales_year_Location, eval=TRUE)
```

#### Step 2 - Visualize

```{r, fig.width=10, fig.height=10}
sales_year_Location%>%
  ggplot(aes(x = year, y = sales, fill = state_of_sale)) +
  geom_col() + 
  facet_wrap(~ state_of_sale) +
  geom_smooth(method = "lm", se = FALSE) +
  scale_y_continuous(labels = scales::dollar_format(big.mark = ".", 
                                                    decimal.mark = ",", 
                                                    prefix = "", 
                                                    suffix = " €")) +
  labs(title = "Trend of bike sale in 12 states of Germany",
       subtitle = "Overall positive trends - North Rhine-Westphalia with most revenues",
       fill = "State")
```

## Writing Files 

### Excel

```{r}
wrangled_table2 %>%
  write_xlsx("C:/Users/Kristin/Documents/Working directory/00_data/01_bike_sales/02_wrangled_data/bike_orderlines_wrangled2.xlsx")
```

### CSV

```{r}
wrangled_table2 %>% 
  write_csv("C:/Users/Kristin/Documents/Working directory/00_data/01_bike_sales/02_wrangled_data/bike_orderlines_wrangled2.csv")
```

### RDS

```{r}
wrangled_table2 %>% 
  write_rds("C:/Users/Kristin/Documents/Working directory/00_data/01_bike_sales/02_wrangled_data/bike_orderlines_wrangled2.rds")
```



# Second Challenge - Data Acquisition  